<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tibia: Winter Wolf Fur Hunting</title>
    <style>
        /* Estilos gerais */
        :root {
            --primary-color: #4a2e7a;
            --secondary-color: #6c3483;
            --accent-color: #9b59b6;
            --light-color: #f5f5f5;
            --dark-color: #333;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f0f2f5; color: var(--dark-color); line-height: 1.6; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }

        /* Cabeçalho */
        header { text-align: center; margin-bottom: 30px; padding: 20px 0; background-color: var(--primary-color); color: white; border-radius: var(--border-radius); box-shadow: var(--box-shadow); }
        header h1 { font-size: 2.5rem; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3); }

        /* Controles */
        .controls { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px; }
        .button-group { display: flex; gap: 10px; }
        .btn { padding: 10px 20px; background-color: var(--secondary-color); color: white; border: none; border-radius: var(--border-radius); cursor: pointer; font-weight: 600; transition: var(--transition); }
        .btn:hover { background-color: var(--accent-color); transform: translateY(-2px); }
        .btn.active { background-color: var(--accent-color); box-shadow: 0 0 0 2px rgba(155, 89, 182, 0.5); }
        .search-container { flex-grow: 1; max-width: 400px; }
        #search-input { width: 100%; padding: 10px 15px; border: 2px solid #ddd; border-radius: var(--border-radius); font-size: 1rem; transition: var(--transition); }
        #search-input:focus { border-color: var(--accent-color); outline: none; box-shadow: 0 0 0 2px rgba(155, 89, 182, 0.3); }

        /* Cards */
        .cards-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .card { background-color: white; border-radius: var(--border-radius); overflow: hidden; box-shadow: var(--box-shadow); transition: var(--transition); display: flex; flex-direction: column; }
        .card:hover { transform: translateY(-5px); box-shadow: 0 8px 15px rgba(0, 0, 0, 0.15); }
        .card-header { background-color: var(--secondary-color); color: white; padding: 15px; text-align: center; position: relative; }
        .card-header h2 { font-size: 1.4rem; margin: 0; text-overflow: ellipsis; overflow: hidden; white-space: nowrap; }
        .card-header .server-name { font-size: 0.9rem; font-weight: 300; opacity: 0.8; margin-top: 4px; }
        .card-header .edit-btn { position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: rgba(255,255,255,0.2); border: none; color: white; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; font-size: 16px; display: flex; align-items: center; justify-content: center; }
        .card-header .edit-btn:hover { background: rgba(255,255,255,0.4); }
        .card-body { padding: 15px; flex-grow: 1; }
        .info-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; padding-bottom: 8px; border-bottom: 1px solid #eee; }
        .info-row:last-child { border-bottom: none; }
        .label { font-weight: 600; color: var(--dark-color); }
        .value { color: var(--secondary-color); font-weight: 500; text-align: right; }
        .card-footer { display: flex; justify-content: space-between; padding: 10px 15px; background-color: #f9f9f9; gap: 10px; }
        .btn-increment, .btn-decrement { padding: 8px 15px; border: none; border-radius: var(--border-radius); cursor: pointer; font-weight: 600; transition: var(--transition); flex: 1; color: white; }
        .btn-increment { background-color: var(--success-color); }
        .btn-decrement { background-color: var(--warning-color); }
        .btn-increment:hover, .btn-decrement:hover { opacity: 0.9; transform: translateY(-1px); }
        .card-actions { padding: 0 15px 15px 15px; background-color: #f9f9f9; }
        .btn-remove { background-color: var(--danger-color); color: white; border: none; border-radius: var(--border-radius); padding: 10px; cursor: pointer; font-weight: 600; transition: var(--transition); width: 100%; }
        .btn-remove:hover { opacity: 0.9; }

        /* Resumo e Adicionar Personagem */
        .summary-container, .add-char-container { margin-top: 30px; }
        .summary-box, .add-char-box { background-color: white; border-radius: var(--border-radius); padding: 20px; box-shadow: var(--box-shadow); }
        .summary-box h3, .add-char-box h3 { color: var(--primary-color); margin-bottom: 15px; font-size: 1.5rem; border-bottom: 2px solid var(--accent-color); padding-bottom: 10px; }
        #summary-content { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        #summary-content p { font-size: 1.1rem; }
        #summary-content span { color: var(--secondary-color); font-weight: 600; }
        .add-char-form { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .form-group { margin-bottom: 10px; }
        .form-group.full-width { grid-column: 1 / -1; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 600; }
        .form-group input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: var(--border-radius); font-size: 1rem; }
        .form-group input:focus { outline: none; border-color: var(--accent-color); box-shadow: 0 0 0 2px rgba(155, 89, 182, 0.3); }
        .btn-add-char { background-color: var(--success-color); color: white; border: none; border-radius: var(--border-radius); padding: 12px 20px; cursor: pointer; font-weight: 600; transition: var(--transition); margin-top: 10px; width: 100%; grid-column: 1 / -1; }
        .btn-add-char:hover { opacity: 0.9; transform: translateY(-2px); }

        /* Modal */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); align-items: center; justify-content: center; }
        .modal-content { background-color: white; margin: auto; padding: 25px; border-radius: var(--border-radius); box-shadow: 0 5px 20px rgba(0,0,0,0.25); width: 90%; max-width: 500px; animation: modalFadeIn 0.3s; }
        @keyframes modalFadeIn { from {opacity: 0; transform: translateY(-50px);} to {opacity: 1; transform: translateY(0);} }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid #eee; }
        .modal-header h3 { color: var(--primary-color); margin: 0; }
        .close-modal { color: #aaa; font-size: 28px; font-weight: bold; cursor: pointer; }
        .close-modal:hover { color: var(--dark-color); }
        .modal-body { margin-bottom: 20px; }
        .modal-footer { display: flex; justify-content: flex-end; gap: 10px; }
        #confirm-modal-text { margin-bottom: 20px; font-size: 1.1rem; text-align: center; }

        /* Responsividade */
        @media (max-width: 768px) {
            .controls, .add-char-form { flex-direction: column; align-items: stretch; }
            .add-char-form { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Tibia: Winter Wolf Fur Hunting</h1>
        </header>
        
        <div class="controls">
            <div class="button-group">
                <button id="btn-all" class="btn active">Todos</button>
                <button id="btn-with-items" class="btn">Com Itens</button>
                <button id="btn-without-items" class="btn">Sem Itens</button>
            </div>
            <div class="search-container">
                <input type="text" id="search-input" placeholder="Buscar por servidor ou personagem...">
            </div>
        </div>
        
        <div class="add-char-container">
            <div class="add-char-box">
                <h3>Adicionar Novo Personagem</h3>
                <div class="add-char-form">
                    <div class="form-group">
                        <label for="new-char-server">Servidor:</label>
                        <input type="text" id="new-char-server" placeholder="Ex: Utobra">
                    </div>
                    <div class="form-group">
                        <label for="new-char-name">Personagem:</label>
                        <input type="text" id="new-char-name" placeholder="Ex: Lady Nostradamus">
                    </div>
                    <div class="form-group">
                        <label for="new-char-wolf-price">Preço Winter Wolf Fur:</label>
                        <input type="number" id="new-char-wolf-price" placeholder="Ex: 8000">
                    </div>
                    <div class="form-group">
                        <label for="new-char-tc-price">Preço Tibia Coins:</label>
                        <input type="number" id="new-char-tc-price" placeholder="Ex: 33000">
                    </div>
                    <button id="btn-add-char" class="btn-add-char">Adicionar Personagem</button>
                </div>
            </div>
        </div>
        
        <div class="cards-container" id="cards-container">
            </div>
        
        <div class="summary-container">
            <div class="summary-box">
                <h3>Resumo Geral</h3>
                <div id="summary-content">
                    <p><strong>Total de Personagens:</strong> <span id="total-chars">0</span></p>
                    <p><strong>Total de Itens:</strong> <span id="total-items">0</span></p>
                    <p><strong>Valor Total (GP):</strong> <span id="total-value">0</span></p>
                    <p><strong>Total em TC:</strong> <span id="total-tc">0</span></p>
                </div>
            </div>
        </div>
    </div>
    
    <div id="edit-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Editar Personagem</h3>
                <span class="close-modal" id="edit-close-btn">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="edit-char-server">Servidor:</label>
                    <input type="text" id="edit-char-server">
                </div>
                <div class="form-group">
                    <label for="edit-char-name">Personagem:</label>
                    <input type="text" id="edit-char-name">
                </div>
                <div class="form-group">
                    <label for="edit-char-wolf-price">Preço Winter Wolf Fur:</label>
                    <input type="number" id="edit-char-wolf-price">
                </div>
                <div class="form-group">
                    <label for="edit-char-tc-price">Preço Tibia Coins:</label>
                    <input type="number" id="edit-char-tc-price">
                </div>
            </div>
            <div class="modal-footer">
                <button id="btn-cancel-edit" class="btn">Cancelar</button>
                <button id="btn-save-edit" class="btn btn-increment">Salvar</button>
            </div>
        </div>
    </div>

    <div id="confirm-remove-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Confirmar Remoção</h3>
            </div>
            <div class="modal-body">
                <p id="confirm-modal-text">Você tem certeza?</p>
            </div>
            <div class="modal-footer">
                <button id="btn-cancel-remove" class="btn">Cancelar</button>
                <button id="btn-confirm-remove" class="btn btn-remove">Remover</button>
            </div>
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {

    // --- ELEMENTOS DO DOM ---
    const cardsContainer = document.getElementById('cards-container');
    const searchInput = document.getElementById('search-input');
    const addCharButton = document.getElementById('btn-add-char');
    
    const filterButtons = {
        all: document.getElementById('btn-all'),
        withItems: document.getElementById('btn-with-items'),
        withoutItems: document.getElementById('btn-without-items'),
    };
    const summaryElements = {
        totalChars: document.getElementById('total-chars'),
        totalItems: document.getElementById('total-items'),
        totalValue: document.getElementById('total-value'),
        totalTc: document.getElementById('total-tc'),
    };
    const addCharForm = {
        server: document.getElementById('new-char-server'),
        name: document.getElementById('new-char-name'),
        wolfPrice: document.getElementById('new-char-wolf-price'),
        tcPrice: document.getElementById('new-char-tc-price'),
    };
    const editModalElements = {
        modal: document.getElementById('edit-modal'),
        server: document.getElementById('edit-char-server'),
        name: document.getElementById('edit-char-name'),
        wolfPrice: document.getElementById('edit-char-wolf-price'),
        tcPrice: document.getElementById('edit-char-tc-price'),
    };
    const confirmRemoveModalElements = {
        modal: document.getElementById('confirm-remove-modal'),
        text: document.getElementById('confirm-modal-text'),
    };

    // --- ESTADO DA APLICAÇÃO ---
    let characterData = [];
    let currentFilter = 'all';
    let searchTerm = '';
    let charToEditId = null;
    let charToRemoveId = null;

    // --- DADOS INICIAIS ---
    const initialData = [
        { id: "collabra-zwakka-ironman", servidor: "Collabra", personagem: "Zwakka Ironman", qty: 2, wolfPrice: 11305, tcPrice: 41237 },
        { id: "rasteibra-barba-medieval", servidor: "Rasteibra", personagem: "Barba Medieval", qty: 0, wolfPrice: 11319, tcPrice: 34840 },
        { id: "lutabra-don-fachinetto", servidor: "Lutabra", personagem: "Don Fachinetto", qty: 0, wolfPrice: 6368, tcPrice: 35040 },
        { id: "utobra-lady-nostradamus", servidor: "Utobra", personagem: "Lady Nostradamus", qty: 6, wolfPrice: 8000, tcPrice: 33000 },
        { id: "bombra-mystica-alchemist", servidor: "Bombra", personagem: "Mystica Alchemist", qty: 0, wolfPrice: 3331, tcPrice: 34000 },
        { id: "wintera-rivaldinho", servidor: "Wintera", personagem: "Rivaldinho", qty: 0, wolfPrice: 2209, tcPrice: 34665 },
    ];

    // --- FUNÇÕES DE LÓGICA E CÁLCULO ---
    const formatNumber = (num, decimals = 0) => new Intl.NumberFormat('pt-BR', { minimumFractionDigits: decimals, maximumFractionDigits: decimals }).format(num);

    const calculateDerivedValues = (char) => {
        const metaValue = char.wolfPrice * 25;
        const totalValue = char.qty * char.wolfPrice;
        const tcValue = char.tcPrice > 0 ? totalValue / char.tcPrice : 0;
        const remainingValue = metaValue - totalValue;
        return { meta: metaValue, total: totalValue, quantasTC: tcValue, faltam: remainingValue };
    };

    const saveData = () => localStorage.setItem('tibiaWinterWolfDataV2', JSON.stringify(characterData));

    const loadData = () => {
        try {
            const savedData = localStorage.getItem('tibiaWinterWolfDataV2');
            characterData = savedData ? JSON.parse(savedData) : initialData;
        } catch {
            characterData = initialData;
        }
        render();
    };

    // --- FUNÇÕES DE RENDERIZAÇÃO E UI ---
    const createCharacterCard = (char) => {
        const derived = calculateDerivedValues(char);
        const card = document.createElement('div');
        card.className = 'card';
        card.dataset.id = char.id;
        card.innerHTML = `
            <div class="card-header">
                <h2>${char.personagem}</h2>
                <div class="server-name">${char.servidor}</div>
                <button class="edit-btn" title="Editar personagem">✏️</button>
            </div>
            <div class="card-body">
                <div class="info-row"><span class="label">Quantidade Atual:</span><span class="value">${formatNumber(char.qty)}</span></div>
                <div class="info-row"><span class="label">Preço Winter Wolf Fur:</span><span class="value">${formatNumber(char.wolfPrice)}</span></div>
                <div class="info-row"><span class="label">Preço Tibia Coins:</span><span class="value">${formatNumber(char.tcPrice)}</span></div>
                <hr style="border: 0; border-top: 1px solid #eee; margin: 10px 0;">
                <div class="info-row"><span class="label">Total (GP):</span><span class="value">${formatNumber(derived.total)}</span></div>
                <div class="info-row"><span class="label">Total em TC:</span><span class="value">${formatNumber(derived.quantasTC, 2)}</span></div>
                <div class="info-row"><span class="label">Meta (p/ 25):</span><span class="value">${formatNumber(derived.meta)}</span></div>
                <div class="info-row"><span class="label">Faltam (GP):</span><span class="value">${formatNumber(derived.faltam)}</span></div>
            </div>
            <div class="card-footer">
                <button class="btn-decrement">-1</button>
                <button class="btn-increment">+1</button>
            </div>
            <div class="card-actions">
                <button class="btn-remove">Remover Personagem</button>
            </div>`;
        return card;
    };

    const updateSummary = () => {
        summaryElements.totalChars.textContent = characterData.length;
        const totalItems = characterData.reduce((sum, char) => sum + char.qty, 0);
        const totalValue = characterData.reduce((sum, char) => sum + calculateDerivedValues(char).total, 0);
        const totalTc = characterData.reduce((sum, char) => sum + calculateDerivedValues(char).quantasTC, 0);
        summaryElements.totalItems.textContent = formatNumber(totalItems);
        summaryElements.totalValue.textContent = formatNumber(totalValue);
        summaryElements.totalTc.textContent = formatNumber(totalTc, 2);
    };
    
    const render = () => {
        cardsContainer.innerHTML = '';
        const filteredData = characterData.filter(char => {
            const matchesFilter = (currentFilter === 'all') || (currentFilter === 'withItems' && char.qty > 0) || (currentFilter === 'withoutItems' && char.qty === 0);
            const lowerSearchTerm = searchTerm.toLowerCase();
            const matchesSearch = !searchTerm || char.personagem.toLowerCase().includes(lowerSearchTerm) || char.servidor.toLowerCase().includes(lowerSearchTerm);
            return matchesFilter && matchesSearch;
        });
        if (filteredData.length === 0) {
            cardsContainer.innerHTML = `<p style="text-align: center; grid-column: 1 / -1; color: #777;">Nenhum personagem encontrado.</p>`;
        } else {
            filteredData.forEach(char => cardsContainer.appendChild(createCharacterCard(char)));
        }
        updateSummary();
        updateFilterButtons();
    };
    
    // --- FUNÇÕES DE MANIPULAÇÃO DE DADOS ---
    const handleAddCharacter = () => {
        const server = addCharForm.server.value.trim();
        const name = addCharForm.name.value.trim();
        const wolfPrice = parseFloat(addCharForm.wolfPrice.value) || 0;
        const tcPrice = parseFloat(addCharForm.tcPrice.value) || 0;

        if (!server || !name || wolfPrice <= 0 || tcPrice <= 0) {
            alert("Por favor, preencha todos os campos com valores válidos.");
            return;
        }

        const id = `${server.toLowerCase().replace(/\s/g, '-')}-${name.toLowerCase().replace(/\s/g, '-')}`;
        if (characterData.some(char => char.id === id)) {
            alert("Este personagem já existe neste servidor.");
            return;
        }

        characterData.push({ id, servidor: server, personagem: name, qty: 0, wolfPrice, tcPrice });
        saveData();
        render();

        addCharForm.server.value = '';
        addCharForm.name.value = '';
        addCharForm.wolfPrice.value = '';
        addCharForm.tcPrice.value = '';
    };

    const updateQuantity = (id, change) => {
        const char = characterData.find(c => c.id === id);
        if (char) {
            char.qty = Math.max(0, char.qty + change);
            saveData();
            render();
        }
    };
    
    // --- MODAL DE EDIÇÃO ---
    const openEditModal = (id) => {
        const char = characterData.find(c => c.id === id);
        if (char) {
            charToEditId = id;
            editModalElements.server.value = char.servidor;
            editModalElements.name.value = char.personagem;
            editModalElements.wolfPrice.value = char.wolfPrice;
            editModalElements.tcPrice.value = char.tcPrice;
            editModalElements.modal.style.display = 'flex';
        }
    };

    const closeEditModal = () => {
        editModalElements.modal.style.display = 'none';
        charToEditId = null;
    };

    const handleSaveEdit = () => {
        if (!charToEditId) return;
        const char = characterData.find(c => c.id === charToEditId);
        const server = editModalElements.server.value.trim();
        const name = editModalElements.name.value.trim();
        const wolfPrice = parseFloat(editModalElements.wolfPrice.value) || 0;
        const tcPrice = parseFloat(editModalElements.tcPrice.value) || 0;

        if (!server || !name || wolfPrice <= 0 || tcPrice <= 0) {
            alert("Por favor, preencha todos os campos com valores válidos.");
            return;
        }
        
        const newId = `${server.toLowerCase().replace(/\s/g, '-')}-${name.toLowerCase().replace(/\s/g, '-')}`;
        if (newId !== charToEditId && characterData.some(c => c.id === newId)) {
            alert("Já existe um personagem com este nome neste servidor.");
            return;
        }
        
        char.id = newId;
        char.servidor = server;
        char.personagem = name;
        char.wolfPrice = wolfPrice;
        char.tcPrice = tcPrice;

        saveData();
        render();
        closeEditModal();
    };
    
    // --- MODAL DE REMOÇÃO ---
    const openConfirmRemoveModal = (id) => {
        const char = characterData.find(c => c.id === id);
        if (char) {
            charToRemoveId = id;
            confirmRemoveModalElements.text.textContent = `Tem certeza que deseja remover ${char.personagem} de ${char.servidor}?`;
            confirmRemoveModalElements.modal.style.display = 'flex';
        }
    };

    const closeConfirmRemoveModal = () => {
        confirmRemoveModalElements.modal.style.display = 'none';
        charToRemoveId = null;
    };

    const handleRemoveCharacter = () => {
        if (!charToRemoveId) return;
        characterData = characterData.filter(char => char.id !== charToRemoveId);
        saveData();
        render();
        closeConfirmRemoveModal();
    };

    // --- FILTROS E BUSCA ---
    const updateFilterButtons = () => {
        Object.values(filterButtons).forEach(btn => btn.classList.remove('active'));
        filterButtons[currentFilter].classList.add('active');
    };
    
    // --- GERENCIADOR CENTRAL DE EVENTOS (EVENT DELEGATION) ---
    document.body.addEventListener('click', (e) => {
        // Clicks nos cards
        const card = e.target.closest('.card');
        if (card) {
            const cardId = card.dataset.id;
            if (e.target.matches('.edit-btn')) openEditModal(cardId);
            if (e.target.matches('.btn-increment')) updateQuantity(cardId, 1);
            if (e.target.matches('.btn-decrement')) updateQuantity(cardId, -1);
            if (e.target.matches('.btn-remove')) openConfirmRemoveModal(cardId);
            return;
        }

        // Clicks nos modais e filtros
        switch (e.target.id) {
            case 'btn-add-char': handleAddCharacter(); break;
            // Filtros
            case 'btn-all': currentFilter = 'all'; render(); break;
            case 'btn-with-items': currentFilter = 'withItems'; render(); break;
            case 'btn-without-items': currentFilter = 'withoutItems'; render(); break;
            // Modal de Edição
            case 'btn-save-edit': handleSaveEdit(); break;
            case 'btn-cancel-edit':
            case 'edit-close-btn':
                closeEditModal();
                break;
            // Modal de Remoção
            case 'btn-confirm-remove': handleRemoveCharacter(); break;
            case 'btn-cancel-remove': closeConfirmRemoveModal(); break;
        }

        // Fechar modal ao clicar no fundo
        if (e.target.matches('.modal')) {
            closeEditModal();
            closeConfirmRemoveModal();
        }
    });

    searchInput.addEventListener('input', (e) => {
        searchTerm = e.target.value;
        render();
    });

    // --- INICIALIZAÇÃO ---
    loadData();
});
</script>
</body>
</html>
